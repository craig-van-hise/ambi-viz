# Product Requirements Prompt (PRP)

## 1. Project Context & Objectives
You are debugging a state-leakage regression in the AmbiViz Three.js visualizer. A recently implemented "Inside View" Zoom slider manipulates the `PerspectiveCamera.fov`. However, this ultra-wide FOV persists when the user toggles to the "Outside View", causing severe perspective distortion. 

Your objective is to decouple the Field of View (FOV) states between the two camera modes. The Outside view must forcefully reset to a standard default FOV, while the Inside view must restore the user's custom zoom FOV.

## 2. Technical Decisions & Dependencies
* **Camera Mechanics Distinction:** * **Inside View:** "Zooming" is achieved via lens manipulation (altering `PerspectiveCamera.fov`).
  * **Outside View:** "Zooming" is achieved via physical camera translation (managed by `OrbitControls` distance). The FOV must remain statically locked to a standard perspective (e.g., 50Â° or whatever the original baseline was) to prevent rendering distortion.
* **State Management:** The UI state governing the slider must maintain the `insideFov` value independently. The Three.js camera must be explicitly updated during the transition between view modes.

## 3. Implementation Phases

### Phase 1: FOV State Decoupling
* **Objective:** Establish isolated FOV values for the respective view modes.
* **Instructions:**
    1. Open the component or class managing the camera transitions (likely `AmbiScene.ts` or the React wrapper handling the view toggle).
    2. Define a strict constant for the outside view's lens: `const DEFAULT_OUTSIDE_FOV = 50;` (adjust to 45 or 75 if the original codebase used a different baseline).
    3. Ensure the current value of the Inside Zoom slider is tracked in a variable/state (e.g., `currentInsideFov`).

### Phase 2: View Transition Interception
* **Objective:** Forcefully apply the correct FOV and update the projection matrix exactly when the view mode changes.
* **Instructions:**
    1. Locate the exact function or `useEffect` block that executes when the user toggles between "Inside" and "Outside".
    2. Add conditional logic to mutate the camera immediately:
       * **If switching to Outside:** `camera.fov = DEFAULT_OUTSIDE_FOV;`
       * **If switching to Inside:** `camera.fov = currentInsideFov;`
    3. **Critical:** Immediately after modifying the FOV in either direction, you MUST call `camera.updateProjectionMatrix();`. If this is omitted, the renderer will not apply the changes.
* **TDD Checkpoint:** AGENT INSTRUCTION: Write or update the test simulating the view toggle. Assert that `camera.fov` strictly equals the default value when in outside mode, and strictly equals the dynamic slider value when in inside mode. Verify that `updateProjectionMatrix()` is called exactly once per transition. Do not proceed until tests PASS.

## 4. Final Review
1. Set the Inside view to maximum zoom out (highest FOV).
2. Toggle to the Outside view. Verify that the sphere looks normal, proportional, and is not stretched along the Z-axis.
3. Toggle back to the Inside view. Verify that the camera lens snaps perfectly back to the wide-angle zoom level you previously set.