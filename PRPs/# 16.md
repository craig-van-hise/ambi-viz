# Product Requirements Prompt (PRP)

## 1. Project Context & Objectives
This is a high-priority hotfix for two regressions identified in the AmbiViz application. 
First, the transport "Previous" and "Next" actions are currently only updating the queue selection without stopping the actively playing track and auto-playing the new selection.
Second, the newly implemented Inside/Outside segmented view toggle suffers from a severe CSS contrast issue where the unselected button text (white) blends into the background (white).

## 2. Technical Decisions & Dependencies
* **Playback Override Logic:** To ensure seamless track switching, the `AudioEngine`'s `next()` and `prev()` methods must execute a strict sequence: `this.stop()` -> `await this.loadTrack()` -> `this.play()`. The UI handlers in the parent component must directly invoke these engine methods.
* **CSS Contrast Enforcement:** The inactive state of the View Toggle buttons must strictly enforce a dark text color (e.g., `#333333` or `black`), a transparent or white background, and a visible border (`1px solid #cccccc`) to ensure it is recognizable as an interactive element.

## 3. Implementation Phases

### Phase 1: Enforce Strict Auto-Play on Transport Navigation
* **Objective:** Guarantee that clicking Previous or Next halts current playback, loads the target track, and immediately begins playing it.
* **Instructions:**
    1. Open `src/audio/AudioEngine.ts`.
    2. Locate the `prev()` and `next()` methods.
    3. Modify both methods to explicitly call `this.stop()` *before* invoking `await this.loadTrack(newIdx)`. This ensures the active `AudioBufferSourceNode` is disconnected and destroyed.
    4. Ensure `this.play()` is called immediately after `loadTrack` resolves.
    5. Check the parent component (e.g., `App.tsx`) where `TransportControls` is rendered. Verify that the `onNext` and `onPrev` props are bound directly to `engine.next()` and `engine.prev()`, and are not merely updating a React state index.
* **TDD Checkpoint:** AGENT INSTRUCTION: Write or update an integration test for `AudioEngine`. Assert that calling `next()` while `playbackState === 'playing'` results in the current source node being stopped, the index incrementing, and a *new* source node starting. Do not proceed until this test outputs a PASS.

### Phase 2: Resolve View Toggle Inactive State Visibility
* **Objective:** Fix the white-on-white graphic glitch on the Inside/Outside view buttons.
* **Instructions:**
    1. Locate the CSS file governing the view toggle (e.g., `App.css` or `index.css`).
    2. Inspect the class applied to the *inactive* state of the toggle buttons.
    3. Update the CSS rules for the inactive button to include:
       ```css
       background-color: transparent; /* or #ffffff */
       color: #000000; /* Force black/dark text */
       border: 1px solid #a0a0a0; /* Visible outline */
       ```
    4. Ensure the *active* state retains its contrasting background (e.g., dark background with white text) and lacks the border if desired, creating a clear visual dichotomy.
* **TDD Checkpoint:** AGENT INSTRUCTION: Start the development server and visually verify the DOM. Ensure the unselected button text is readable and the button boundary is clearly defined.

## 4. Final Review
1. Confirm that while a track is actively producing audio, clicking "Next" immediately cuts the current audio and begins playing the next track.
2. Confirm that the Inside/Outside toggle clearly displays both options simultaneously, with the inactive option featuring dark text and a visible border.