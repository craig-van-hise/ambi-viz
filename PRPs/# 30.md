# Product Requirements Prompt (PRP): 3D Pointer Restoration & Coordinate Correction

## 1. Project Context & Objectives
The "Stationary World" pivot continues, but we are reverting the 2D UI pointer in favor of the original **3D Green Arrow**. The objectives are to:
1. Fix the inverted Audio Yaw (ensuring sound moves to the correct ear).
2. Fix the inverted Visual Yaw and Pitch (ensuring the 3D arrow follows the user's nose).
3. Lock the 3D camera while head tracking is active to prevent visual "drift" or "smearing."

## 2. Technical Decisions & System Integrity
* **3D Pointer Restoration:** Re-implement the original 3D Mesh (Green Arrow/Cone). **AGENT INSTRUCTION:** Instead of adding this mesh to the global `scene`, you MUST add it as a child of the `camera` (`this.camera.add(pointer)`). Position it at `(0, 0, -1.5)` so it remains fixed in the user's field of view as a 3D reticle.
* **Audio-Visual Sign Separation:**
    * **Audio Path:** Invert the current Yaw logic sent to the `OBRDecoder`. If "Look Left" currently makes sound go "Left," flip the sign of the Yaw float in the SAB/WASM call.
    * **Visual Path:** The `pointer.rotation` must be mapped to tracker data. Based on the "backwards" report:
        * Apply `pointer.rotation.y = -rawYaw` (or the inverse of the current state) to fix Left/Right orientation.
        * Apply `pointer.rotation.x = -rawPitch` (or the inverse of the current state) to fix Up/Down orientation.
* **Camera Freeze:** When `isTracking` is active, the `camera.rotation` must be hard-reset to `(0, 0, 0)` every frame. Only the pointer mesh rotates.

## 3. Implementation Phases

### Phase 1: 3D HUD Restoration & Camera Lock
* **Objective:** Restore the 3D Green Arrow as a nose-locked pointer and freeze the background.
* **Instructions:**
    1. Locate the original 3D Green Arrow code in `src/visualizer/AmbiScene.ts`.
    2. Ensure it is instantiated and added as a child of the `camera`.
    3. In the render loop, add a check: `if (this.isTracking) { this.camera.rotation.set(0, 0, 0); }`.
    4. Ensure `OrbitControls` are disabled while tracking is active.
* **TDD Checkpoint:**
    * **AGENT INSTRUCTION:** Write a programmatic test asserting that `pointerMesh.parent` is the `camera` and that `camera.rotation` does not change even when tracking state is updated.

### Phase 2: Systematic Yaw/Pitch Sign Flip
* **Objective:** Correct the inversions for both the OBR Renderer and the 3D Pointer.
* **Instructions:**
    1. **Audio Fix:** In `src/audio/OBRDecoder.ts` (or the logic bridging the ESKF to the WASM), flip the sign of the Yaw parameter. 
    2. **Visual Fix:** In `AmbiScene.ts`, update the `pointerMesh.rotation`. Based on feedback, if looking Left currently points Right, multiply the rotation value by `-1`.
    3. **Pitch Fix:** If looking Down currently points the arrow Up, multiply the Pitch rotation value by `-1`.
* **TDD Checkpoint:**
    * **AGENT INSTRUCTION:** Write a unit test mocking a "Left" head rotation ($+10^\circ$). Assert that the audio Yaw sent to OBR and the visual rotation of the 3D pointer both move in the mathematically correct directions for their respective systems.

### Phase 3: Telemetry & Cleanup
* **Objective:** Sync the UI sliders to the corrected visual values.
* **Instructions:**
    1. Ensure the React Sliders for Yaw/Pitch/Roll show the same values used by the 3D Pointer.
    2. Verify the 2D "mouse pointer" logic from the previous attempt is completely deleted.
* **TDD Checkpoint:**
    * **AGENT INSTRUCTION:** Verify that the state used for the UI Sliders matches the corrected orientation of the 3D Pointer mesh.

## 4. FINAL REVIEW: HUMAN QA HANDOFF
**AGENT INSTRUCTION:** You are an AI and cannot see the screen or hear the audio. You MUST halt and wait for the user to confirm. 
> "I have restored the **3D Green Pointer** as a HUD element and implemented the requested sign inversions for Yaw and Pitch.
> 
> **Human Developer, please perform these physical checks:**
> 1. **Visual Yaw:** Look Left. Does the 3D Green Arrow point to the Left side of the screen?
> 2. **Visual Pitch:** Look Down. Does the 3D Green Arrow point toward the bottom of the screen?
> 3. **Audio Check:** Put on headphones. Look Left. Does the sound source move correctly toward your **Right Ear**?
> 4. **Stationary View:** Is the 3D background sphere remaining perfectly still while you move your head?
> 
> Please reply with 'Pass' or 'Fail'.".
