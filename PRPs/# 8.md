

```text
**OBJECTIVE: FIX SILENT AUDIO WORKLET (MEMORY & PATHING)**
The Web Audio graph is correctly routed, but the `obr-processor.js` is outputting silence. You must fix the Emscripten memory offsets and the WASM path resolution to ensure the C++ engine actually receives the audio floats.

**INSTRUCTIONS: Rewrite `public/worklets/obr-processor.js`**

1. **Fix WASM Path Resolution:**
   When instantiating the module, you MUST override the `locateFile` function so Emscripten knows to look in the root `/public` directory, not relative to the worklet.
   ```javascript
   import ModuleFactory from '../obr.js';
   // Inside constructor:
   ModuleFactory({
       locateFile: (path) => {
           if (path.endsWith('.wasm')) return '/obr.wasm';
           return path;
       }
   }).then((wasm) => { ... });

```

2. **Fix The Pointer Arithmetic (Division by 4):**
`_malloc` returns a byte offset. `HEAPF32` uses float indices. You MUST divide your pointers by 4 when interacting with `HEAPF32`.
```javascript
// Inside setupWasm / initialization:
this.inPtr = this.wasm._malloc(numChannels * 128 * 4);
this.outPtr = this.wasm._malloc(2 * 128 * 4);
this.inOffset = this.inPtr / 4;
this.outOffset = this.outPtr / 4;

```


3. **Fix the Channel Packing (Planar Arrays):**
In the `process` loop, Web Audio `inputs[0]` is an array of channels (planar). You must loop through `numChannels` and copy each 128-frame array into `HEAPF32` at the correct offset.
```javascript
// Inside process(inputs, outputs):
if (!this.ready) return true;

const input = inputs[0];
const output = outputs[0];

// 1. Copy to WASM Heap (Planar)
for (let c = 0; c < input.length; c++) {
    if (input[c]) {
        this.wasm.HEAPF32.set(input[c], this.inOffset + (c * 128));
    }
}

// 2. Process
this.wasm._obr_process(this.inPtr, this.outPtr, 128);

// 3. Copy from WASM Heap to outputs (Stereo)
if (output[0]) output[0].set(this.wasm.HEAPF32.subarray(this.outOffset, this.outOffset + 128));
if (output[1]) output[1].set(this.wasm.HEAPF32.subarray(this.outOffset + 128, this.outOffset + 256));

return true;

```



**TDD CHECKPOINT**
Apply these exact math and pathing fixes to `public/worklets/obr-processor.js`. Do not change `AudioEngine.ts`. Tell the user to refresh the browser and drop a file to test the audio output.

```

***

